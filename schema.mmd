erDiagram
    BaseEntity {
        ISODate createdAt %% @validate { required: true, autoGenerate: true } @ui { display: "form|details"}
        ISODate updatedAt %% @validate { required: true, autoUpdate: true } @ui { display: "form|details"}
    }


    Account {
        ISODate expiredAt %% @validate { required: false }
    
    	%% @inherit BaseEntity
    }


    User {
        String username          %% @validate { required: true, minLength: 3, maxLength: 50 }, @ui { displayName: "whos your daddy?" }, @unique
        String email             %% @validate { required: true, minLength: 8, maxLength: 50, pattern: "dictionary=pattern.email", "pattern.message": "Bad email address format" }, @unique
        String password          %% @validate { required: true, minLength: 8 } @ui { displayName: "First Name", display: "details"}
        String firstName         %% @validate { required: true, minLength: 3, maxLength: 100 }, @ui { displayName: "Last Name" }
        String lastName          %% @validate { required: true, minLength: 3, maxLength: 100 }
        String gender            %% @validate { required: false, enum: ["male", "female", "other"], "enum.message": "must be male or female" }
        ISODate dob         
        Boolean isAccountOwner   %% @validate { required: true }, @ui { displayName: "Owner"}
    
    	%% @inherit BaseEntity
    	%% @service auth.cookies.redis 
    }


    Profile {
        String name          %% @validate { required: true, maxLength: 100 }
        JSON preferences     %% @validate { required: false } @ui { display: "details"}
        Integer radiusMiles  %% @validate { required: false, min: 0 }
    
    	%% @inherit BaseEntity
    	%% @unique name + userId
    }


    TagAffinity {
        String tag            %% @validate { required: true, maxLength: 50 }
        Integer affinity      %% @validate { required: true, min: -100, max: 100 }
    
    	%% @inherit BaseEntity
    	%% @unique profileId + tag
    }


    Event {
        String url                         %% @validate { required: true, pattern: "dictionary=pattern.url", "pattern.message": "Bad URL format" }
        String title                       %% @validate { required: true, maxLength: 200 }
        ISODate dateTime                   %% @validate { required: true }
        String location                    %% @validate { required: false, maxLength: 200 }
        Number cost                        %% @validate { required: false, min: 0 } @ui { display: "details"}
        Integer numOfExpectedAttendees     %% @validate { required: false, min: 0 } @ui { display: "details"}
        String recurrence                  %% @validate { required: false, enum: ["daily", "weekly", "monthly", "yearly"] } @ui { display: "details"}
        Array[String] tags                 %% @validate { required: false } @ui { display: "details"}
    
    	%% @inherit BaseEntity
    }


    UserEvent {
        Boolean attended     %% @validate { required: false }
        Integer rating       %% @validate { required: false, min: 1, max: 5 }
        String note          %% @validate { required: false, maxLength: 500 } @ui { display: "details"}
    
    	%% @inherit BaseEntity
    }


    Url {
        String url       %% @validate { required: true, pattern: "dictionary=pattern.url", "pattern.message": "Bad URL format" }
        JSON params      %% @validate { required: false }
    
    	%% @inherit BaseEntity
    }

    Crawl {
        ISODate lastParsedDate             %% @validate { required: false }
        JSON parseStatus                   %% @validate { required: false }
        Array[String] errorsEncountered    %% @validate { required: false }
    
    	%% @inherit BaseEntity
        %% @operations [ "read", "delete" ]
    }


    Account ||--o{ User: ""
    User ||--o{ Profile: ""
    Profile ||--o{ TagAffinity: ""
    User ||--o{ UserEvent: ""
    Event ||--o{ UserEvent: ""
    Url ||--o{ Crawl: ""


%% @dictionary pattern { email: "^[a-zA-Z0-9._%-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$", url: "^https?://[^\s]+$" }
